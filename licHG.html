<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tạo License Key (Mã Hóa)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width: 400px; text-align: center; }
        h1 { color: #333; margin-bottom: 20px; }
        p { color: #666; margin-bottom: 25px; }
        input[type="date"] { width: 95%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; margin-bottom: 20px; }
        button { width: 100%; padding: 12px; border: none; border-radius: 5px; background-color: #007bff; color: white; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #0056b3; }
        #result-container { margin-top: 25px; text-align: left; }
        #result-key { background-color: #e9ecef; padding: 15px; border-radius: 5px; font-family: 'Courier New', Courier, monospace; font-weight: bold; color: #495057; word-wrap: break-word; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Tạo License Key (Mã Hóa)</h1>
        <p>Chọn ngày hết hạn để tạo file <strong>.lic</strong> đã được mã hóa.</p>
        
        <input type="date" id="expiry-date-input">
        
        <button id="generate-btn">Tạo File .lic</button>

        <div id="result-container" style="display: none;">
            <p><strong>Key gốc (dễ đọc):</strong></p>
            <pre id="result-key-decrypted"></pre>
            <p><strong>Key mã hóa (nội dung file .lic):</strong></p>
            <pre id="result-key"></pre>
        </div>
    </div>

    <script>
        const dateInput = document.getElementById('expiry-date-input');
        const generateBtn = document.getElementById('generate-btn');
        const resultContainer = document.getElementById('result-container');
        const resultKeyEl = document.getElementById('result-key');
        const resultKeyDecryptedEl = document.getElementById('result-key-decrypted');

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        window.onload = function() {
            const today = new Date();
            const futureDate = new Date(today.setMonth(today.getMonth() + 3));
            dateInput.value = formatDate(futureDate);
        };

        generateBtn.addEventListener('click', function() {
            const selectedDate = dateInput.value;
            if (!selectedDate) {
                alert('Vui lòng chọn một ngày hết hạn!');
                return;
            }

            const dateObj = new Date(selectedDate);
            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');
            
            // THAY ĐỔI QUAN TRỌNG: Tạo key theo đúng định dạng RDI-YYYYMMDD
            const licenseKey = `RDI-${year}${month}${day}`;
            
            const encryptedKey = btoa(licenseKey);

            resultKeyDecryptedEl.textContent = licenseKey;
            resultKeyEl.textContent = encryptedKey;
            resultContainer.style.display = 'block';

            createDownloadableFile(encryptedKey, 'license.lic');
        });

        function createDownloadableFile(content, fileName) {
            const blob = new Blob([content], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
    </script>

</body>
</html>
